---
title: "Almond Yield as a Function"
author: "Kristin Gill"
date: "4/8/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(tidyverse)
library(janitor)
library(here)
library(lubridate)
library(patchwork)
```

```{r}
almond_climate_original <- read.table(here("data", "clim.txt")) %>% 
  clean_names()

almond_climate <- almond_climate_original %>% 
  mutate(date = as_date(d)) %>% 
  mutate(year = year(date)) %>%
  mutate(month = month(date))

# temp in february
almond_temp <- almond_climate %>% 
  filter(month == 2) %>% 
  group_by(year) %>%
  summarize(mean_min = mean(tmin_c)) %>% 
  select(year, mean_min)

# precip in january
almond_precip <- almond_climate %>% 
  filter(month == 1) %>% 
  group_by(year) %>% 
  summarize(mean_p = mean(precip), sum_p = sum(precip)) %>% 
  select(year, sum_p)
```

```{r}
source(here("R", "almond_yield.R"))

yield <- almond_yield(year = almond_temp$year, p = almond_precip$sum_p, Tn = almond_temp$mean_min)
```

```{r}
#Use graph to show the trend of how almond yield changes across years
plot_yield <- ggplot(data = yield, aes(x = year, y = almond_yield)) +
  geom_line() +
  labs(title = "Estimated Almond Yields (tons/acre)", x = "Year", y = "Almond Yield")

plot_temperature <- ggplot(data = almond_temp, aes(x = year, y = mean_min)) +
  geom_line() +
  labs(title = "February Mean Minimum Tempratures (°C)", x = "Year", y = "Mean Min Temp")

plot_precipitation <- ggplot(data = almond_precip, aes(x = year, y = sum_p)) +
  geom_line() +
  labs(title = "January Precipitation (mm)", x = "Year", y = "Precipitation")

plot_yield/plot_precipitation/plot_temperature
```


calculate the almond yield anomaly for each year, and summarize the data. We will leave how to summarize the data up to you. 

Think about what metrics would be best to explain the trends in outputs. Tables, graphs, and summary metrics are all acceptable – these you will generate outside the function in your Rmarkdown. Make sure to include axis labels, units and captions.

Finally, write one paragraph summarizing your findings. Submit pdf of rmarkdown.and the function.R file to gauchospace – Submit as a group

Three answers to check your model against:

2000: 9.59

2001: 159.51

2002: 0.24

